{% extends '_base.html' %}
{% set page_title = "Medical Check Templates" %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Medical Check Templates</h2>
    <a href="/admin/medical_check_templates/new" class="btn btn-primary">+ New Check Template</a>
  </div>

  <input type="text" id="searchInput" class="form-control" placeholder="Search templates...">

  <div class="table-responsive mt-3">
    <table id="typesTable" class="table table-striped table-hover align-middle">
      <thead class="table-primary">
      <tr>
        <th>Name</th>
        <th>Fields</th>
      </tr>
      </thead>
      <tbody>
      {% if types and types|length > 0 %}
        {% for t in types %}
          <tr data-href="/admin/medical_check_templates/{{ t.type_id }}/view" style="cursor: pointer;">
            <td>{{ t.name }}</td>
            <td>
              {# Show comma-separated parameter names #}
              {% if t.items and t.items|length > 0 %}
                {{ t.items | map(attribute='name') | join(', ') }}
              {% else %}
                <span class="text-muted">No fields</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="2" class="text-center text-muted py-4">No check types yet.</td>
        </tr>
      {% endif %}
      </tbody>
    </table>
  </div>

  <script>
    document.getElementById("searchInput").addEventListener("input", function () {
      const query = this.value.toLowerCase();
      const rows = document.querySelectorAll("#typesTable tbody tr");
      rows.forEach(row => {
        const visible = Array.from(row.children).some(td =>
          td.textContent.toLowerCase().includes(query)
        );
        row.style.display = visible ? "" : "none";
      });
    });

    // Make rows clickable to open view page; ignore clicks on links/buttons (if any appear in future)
    document.querySelector('#typesTable tbody').addEventListener('click', function (e) {
      if (e.target.closest('a, button')) {
        return;
      }
      const row = e.target.closest('tr[data-href]');
      if (row) {
        window.location.href = row.getAttribute('data-href');
      }
    });
  </script>
{% endblock %}
